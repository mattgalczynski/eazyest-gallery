(function(e){function n(s){if(t){var o={action:"eazyest_gallery_upgrade_folder",gallery_folder:e("#gallery_folder").val(),images_max:e("#import_image_max").val(),allow_comments:e("input[name=allow_comments]:checked").val(),remove_xml:e("input[name=remove_xml]:checked").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,o,function(t){if(t!="0"){var o=parseInt(t,10);if(o!=s){var u=parseInt(e("#current-folder").html());u++;e("#current-folder").html(u)}n(o)}else{e("#folder-counter").html(eazyestUpgraderSettings.ready);if("1"==e("input[name=convert_page]:checked").val()){r()}else{i()}}})}}function r(){if("1"==e("input[name=convert_page]:checked").val()&&t){e("#upgrade_page").show();var n={action:"eazyest_gallery_convert_page",gallery_id:e("#gallery_id").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(e){i()})}}function i(){if(t){e("#upgrade-settings").show();var n={action:"eazyest_gallery_update_settings",gallery_folder:e("#gallery_folder").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(t){e("#upgrade-cleanup").show();s()})}}function s(){if(t){var n={action:"eazyest_gallery_cleanup",_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,n,function(t){e("#start-upgrade").hide();e("#upgrade-process-title").html(eazyestUpgraderSettings.finished);e("#upgrade-success").show()})}}function o(){if(!t){e("#skip").hide();e("#upgrade-process").show();e("#upgrade-error").hide();e("#start-upgrade").html(eazyestUpgraderSettings.stop);e("#start-upgrade").removeClass("button-primary");e("#upgrade-form :input").attr("disabled",true);t=true}else{e("#skip").show();e("#upgrade-process").hide();e("#current-folder").html("0");e("#start-upgrade").html(eazyestUpgraderSettings.restart);e("#start-upgrade").addClass("button-primary");t=false}if(t){var r={action:"eazyest_gallery_get_upgrade_folders",gallery_folder:e("#gallery_folder").val(),_ajax_nonce:e("#_wpnonce").val()};e.post(ajaxurl,r,function(r){if("empty"==r){e("#upgrade-error").show();e("#start-upgrade").html(eazyestUpgraderSettings.restart);t=false}else{var i=parseInt(r,10);if(i>0){e("#current-folder").html("1");e("#all-folders").html(i);e("#folder-counter").show();n(i)}}})}}var t=false;e(document).ready(function(){e("#start-upgrade").click(function(){o();return false});e("#skip_upgrade").click(function(){e(this).parents("form").submit()});e("#gallery_folder").change(function(){var t={action:"eazyest_gallery_folder_change",_wpnonce:e("#gallery-folder-nonce").val(),gallery_folder:e("#gallery_folder").val()};e.post(ajaxurl,t,function(t){if(0==t.result){e("#eazyest-ajax-response").hide();e("#create-folder").hide()}else{if(1==t.result){e("#eazyest-ajax-response").html(eazyestUpgraderSettings.errorMessage.replace("%s","<code>"+e("#gallery_folder").val()+"</code>")).show("fast",function(){e("#gallery_folder").val(t.folder)})}else{e("#eazyest-ajax-response").html(eazyestUpgraderSettings.notExistsMessage).show("fast",function(){e("#gallery_folder").val(t.folder)})}}});return false})})})(jQuery)